# Clash Chain Patcher - 快速开始

**5 分钟上手指南**

---

## 🚀 安装运行

```bash
# 克隆仓库
git clone <your-repo-url>
cd clash-chain-patcher

# 编译（首次需要 2-3 分钟）
cargo build --release

# 运行
./target/release/clash-chain-patcher
```

---

## 📋 基本使用（5 步）

### 第 1 步：添加代理

```
填写表单：
  Host: 64.32.179.160
  Port: 60088
  User: myusername
  Pass: mypassword

点击 [+ Add]
```

**提示**: 可以添加多个代理（最多 10 个）

---

### 第 2 步：检测健康（二选一）

#### 选项 A：手动检测（立即查看）
```
点击 [Check All] → 等待 10-30 秒
```

#### 选项 B：自动检测（长期监控）⭐ 推荐
```
1. Interval 输入框：5  (5 分钟)
2. 点击 [Auto: OFF] → 变为 [Auto: ON]
3. 每 5 分钟自动检测，无需手动操作
```

---

### 第 3 步：选择 Clash 配置

```
点击 [Select] → 选择你的 Clash 配置文件
例如：~/.config/clash/config.yaml
```

**快速选择**:
- 点击右侧 `▼` 查看最近使用的文件
- 点击文件名快速加载

---

### 第 4 步：Apply 应用

```
点击 [Apply] 按钮

Output 显示：
  Using proxy pool mode
  Enabled proxies: 2
  Local proxy: 127.0.0.1:10808
```

**做了什么**:
- ✅ 启动本地链式代理 (127.0.0.1:10808)
- ✅ 在 Clash 配置中添加 "Local-Chain-Proxy" 节点
- ✅ 自动备份原配置

---

### 第 5 步：在 Clash 中使用

```
1. 刷新 Clash 配置（或重启 Clash）
2. 在代理组中找到 "Local-Chain-Proxy"
3. 选择使用它
4. 完成！流量现在经过你的代理链
```

---

## 🎯 流量路径

```
你的应用
   ↓
Clash (选择 Local-Chain-Proxy)
   ↓
本地链式代理 (127.0.0.1:10808)
   ↓
代理 1 (64.32.179.160:60088)
   ↓
代理 2 (另一个代理)
   ↓
目标网站
```

---

## ✨ 高级功能

### 自动健康检测

**最佳实践**:
```
1. 设置 Interval: 5 分钟
2. 点击 Auto: OFF → ON
3. 应用会自动：
   - 每 5 分钟检测所有代理
   - 更新健康状态（✓/×）
   - 显示延迟和位置
   - 完全不阻塞界面
```

**调整间隔**:
- 快速调试：1 分钟
- 日常使用：5 分钟（默认）
- 长期监控：10-30 分钟

---

### 配置文件监控

```
1. 选择 Clash 配置后
2. 点击 [Watch: OFF] → [Watch: ON]
3. 监控配置文件变化
```

**用途**: 当 Clash 订阅更新覆盖配置时，自动重新添加链式代理

---

## 📊 界面说明

```
┌─────────────────────────────────────────────────────┐
│ Config [Select] config.yaml [×] [Watch: ON] [▼]    │  ← 配置文件管理
├─────────────────────────────────────────────────────┤
│ Host: [_______] Port: [____]                        │  ← 代理信息
│ User: [_______] Pass: [____]                        │
│ [Fill]                                              │
├─────────────────────────────────────────────────────┤
│ Proxy Pool [+Add] [Check All] [Auto: ON]           │  ← 代理池控制
│            Interval: [5] min [Clear All]            │
│                                                     │
│ ✓ [Proxy-1] 64.32.179.160:60088 120ms | US        │  ← 代理槽位
│ ✓ [Proxy-2] 192.168.1.1:1080 85ms | CN            │
├─────────────────────────────────────────────────────┤
│ [Preview] [Apply] [Save]                           │  ← 操作按钮
├─────────────────────────────────────────────────────┤
│ Output:                                             │
│ ✓ Auto health check started                        │  ← 状态输出
│   Checking every 5 minutes                          │
│   Monitoring 2 enabled proxies                      │
└─────────────────────────────────────────────────────┘
```

---

## 🎮 按钮功能

| 按钮 | 功能 |
|------|------|
| **+ Add** | 添加代理到池 |
| **Check All** | 手动检测所有代理（10-30秒） |
| **Auto: OFF/ON** | 开关自动检测（后台定时） |
| **Clear All** | 清空代理池 |
| **Select** | 选择 Clash 配置文件 |
| **×** (红色) | 清除当前配置文件 |
| **Watch: OFF/ON** | 开关配置文件监控 |
| **▼/▲** | 展开/折叠文件历史 |
| **Preview** | 预览配置（不修改文件） |
| **Apply** | 应用配置（启动代理+修改Clash） |
| **Save** | 保存输出到文件 |

---

## ❓ 常见问题 3 秒解答

**Q: 代理池显示 0 proxies？**
A: 确认点击了 "+ Add" 按钮

**Q: Apply 没反应？**
A: 检查是否选择了 Clash 配置文件

**Q: 自动检测不工作？**
A: 等待设置的间隔时间（如 5 分钟）

**Q: 如何停止自动检测？**
A: 点击 "Auto: ON" → 变为 "Auto: OFF"

**Q: 如何删除代理？**
A: 点击代理槽位右侧的 "×" 按钮

---

## 📚 完整文档

详细说明：[doc/USAGE-GUIDE-CN.md](doc/USAGE-GUIDE-CN.md)

包含：
- 详细步骤说明
- 高级功能教程
- 故障排除
- 最佳实践
- 性能说明

---

## 🎉 开始使用！

```bash
cargo run --release
```

**5 分钟配置完成，享受自动化的代理链管理！**

---

## 💡 推荐工作流

```
启动应用
  ↓
添加 2-3 个代理
  ↓
开启自动检测 (Auto: ON, Interval: 5)
  ↓
选择 Clash 配置文件
  ↓
开启 Watch 监控
  ↓
Apply 应用
  ↓
在 Clash 中使用 Local-Chain-Proxy
  ↓
后台自动维护，无需手动操作！
```

**That's it!** 🚀
