# UI 设计文档 - Phase 3

**设计日期**: 2026-02-02
**目标**: 设计带有 Tab 导航的多功能界面

---

## 整体布局

```
┌─────────────────────────────────────────────────────────┐
│  Clash Chain Patcher                            [- □ ×] │
├─────────────────────────────────────────────────────────┤
│  [代理管理] [健康检查] [监控] [合并] [设置]              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│                                                         │
│                     Tab Content Area                    │
│                                                         │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  Status Bar: 就绪                                       │
└─────────────────────────────────────────────────────────┘
```

---

## Tab 1: 代理管理 (ProxyListTab)

```
┌─────────────────────────────────────────────────────────┐
│  上游代理列表                              [+ 添加代理]   │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │ ☑ Hong Kong Proxy          ✅ 健康  123ms       │  │
│  │   64.32.179.160:60088                           │  │
│  │   [编辑] [删除] [禁用]                          │  │
│  ├─────────────────────────────────────────────────┤  │
│  │ ☐ Singapore Proxy          ❌ 不健康            │  │
│  │   45.76.123.45:1080                             │  │
│  │   [编辑] [删除] [启用]                          │  │
│  ├─────────────────────────────────────────────────┤  │
│  │ ☑ US Proxy                 ⚫ 未知              │  │
│  │   192.168.1.100:1080                            │  │
│  │   [编辑] [删除] [禁用]                          │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  统计: 共 3 个代理, 2 个启用, 1 个健康                  │
└─────────────────────────────────────────────────────────┘

【添加/编辑对话框】
┌─────────────────────────────────────┐
│  添加上游代理                      │
├─────────────────────────────────────┤
│  名称: [Hong Kong Proxy         ]  │
│  主机: [64.32.179.160           ]  │
│  端口: [60088                   ]  │
│  用户: [username                ]  │
│  密码: [********                ]  │
│                                     │
│  或使用代理字符串:                  │
│  [host:port:user:pass           ]  │
│                                     │
│     [取消]              [保存]     │
└─────────────────────────────────────┘
```

### 功能点:
- ✅ 显示所有上游代理列表
- ✅ 显示健康状态 (健康/不健康/未知/检查中)
- ✅ 显示延迟 (健康时)
- ✅ 启用/禁用代理
- ✅ 添加/编辑/删除代理
- ✅ 代理选择 (复选框)
- ✅ 统计信息

---

## Tab 2: 健康检查 (HealthCheckTab)

```
┌─────────────────────────────────────────────────────────┐
│  健康检查                                               │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  检查设置:                                              │
│  ┌─────────────────────────────────────────────────┐  │
│  │ 超时时间:    [10        ] 秒                    │  │
│  │ 测试URL:     [http://www.gstatic.com/...     ] │  │
│  │ 失败阈值:    [3         ] 次                    │  │
│  │ 检查间隔:    [60        ] 秒                    │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  [检查所有] [停止检查] [保存设置]                       │
│                                                         │
│  检查结果:                                              │
│  ┌─────────────────────────────────────────────────┐  │
│  │ Hong Kong Proxy                                 │  │
│  │ ✅ 健康  延迟: 123ms                            │  │
│  │ 最后检查: 2026-02-02 14:30:15                   │  │
│  ├─────────────────────────────────────────────────┤  │
│  │ Singapore Proxy                                 │  │
│  │ ❌ 不健康                                       │  │
│  │ 错误: Connection timeout                        │  │
│  │ 连续失败: 3 次                                  │  │
│  │ 最后检查: 2026-02-02 14:30:20                   │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  🔄 正在检查... (2/3)                                   │
└─────────────────────────────────────────────────────────┘
```

### 功能点:
- ✅ 配置健康检查参数
- ✅ 手动检查所有代理
- ✅ 显示检查结果
- ✅ 显示延迟和错误信息
- ✅ 实时更新检查状态
- ✅ 进度指示器

---

## Tab 3: 配置监控 (MonitorTab)

```
┌─────────────────────────────────────────────────────────┐
│  Clash 配置监控                                         │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  配置文件:                                              │
│  ┌─────────────────────────────────────────────────┐  │
│  │ /Users/xxx/.config/clash/config.yaml           │  │
│  │                                  [选择文件]     │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  监控状态: ⚫ 未启动                                    │
│  [启动监控] [停止监控]                                  │
│                                                         │
│  监控设置:                                              │
│  ┌─────────────────────────────────────────────────┐  │
│  │ ☑ 自动监控配置文件变化                          │  │
│  │ ☑ 变化时自动合并本地代理                        │  │
│  │ ☑ 创建备份                                      │  │
│  │ 防抖延迟: [2        ] 秒                        │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  监控日志:                                              │
│  ┌─────────────────────────────────────────────────┐  │
│  │ [14:30:15] 监控已启动                           │  │
│  │ [14:32:20] 检测到配置文件变化                   │  │
│  │ [14:32:22] 自动合并完成                         │  │
│  │ [14:35:10] 检测到配置文件变化                   │  │
│  │ [14:35:12] 自动合并完成                         │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 功能点:
- ✅ 选择 Clash 配置文件
- ✅ 启动/停止监控
- ✅ 显示监控状态
- ✅ 配置监控选项
- ✅ 显示监控日志
- ✅ 自动合并支持

---

## Tab 4: 配置合并 (MergeTab)

```
┌─────────────────────────────────────────────────────────┐
│  配置合并                                               │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  Clash 配置文件:                                        │
│  ┌─────────────────────────────────────────────────┐  │
│  │ /Users/xxx/.config/clash/config.yaml           │  │
│  │                                  [选择文件]     │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  本地代理设置:                                          │
│  ┌─────────────────────────────────────────────────┐  │
│  │ 代理名称: [Local-Chain-Proxy             ]     │  │
│  │ 监听地址: [127.0.0.1                     ]     │  │
│  │ 监听端口: [10808                         ]     │  │
│  │ ☑ 创建备份                                      │  │
│  │ ☑ 插入到开头                                    │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  [执行合并]                                             │
│                                                         │
│  合并结果:                                              │
│  ┌─────────────────────────────────────────────────┐  │
│  │ ✅ 合并成功                                     │  │
│  │                                                 │  │
│  │ • 添加代理节点: ✓                               │  │
│  │ • 更新代理组: 2 个                              │  │
│  │ • 备份文件: config.yaml.20260202_143015.bak    │  │
│  │                                                 │  │
│  │ 提示: 请重启 Clash 使配置生效                   │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 功能点:
- ✅ 选择 Clash 配置文件
- ✅ 配置本地代理参数
- ✅ 执行配置合并
- ✅ 显示合并结果
- ✅ 备份支持
- ✅ 提示信息

---

## Tab 5: 设置 (SettingsTab)

```
┌─────────────────────────────────────────────────────────┐
│  应用设置                                               │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  通用设置:                                              │
│  ┌─────────────────────────────────────────────────┐  │
│  │ ☑ 启动时自动加载配置                            │  │
│  │ ☑ 最小化到系统托盘                              │  │
│  │ ☑ 启动时自动打开监控                            │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  配置文件位置:                                          │
│  ┌─────────────────────────────────────────────────┐  │
│  │ ~/.config/clash-chain-patcher/config.json      │  │
│  │                                  [打开文件夹]   │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  关于:                                                  │
│  ┌─────────────────────────────────────────────────┐  │
│  │ Clash Chain Patcher v0.2.0                      │  │
│  │                                                 │  │
│  │ 为 Clash 配置添加 SOCKS5 代理链的 GUI 工具      │  │
│  │                                                 │  │
│  │ GitHub: github.com/xxx/clash-chain-patcher      │  │
│  │ License: MIT                                    │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  [重置所有设置] [导出配置] [导入配置]                   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 功能点:
- ✅ 应用通用设置
- ✅ 配置文件管理
- ✅ 关于信息
- ✅ 导入/导出配置
- ✅ 重置设置

---

## 配色方案

### 主题色
- **背景色**: `#1a1a1a` (深黑)
- **卡片背景**: `#2a2a2a` (深灰)
- **输入框背景**: `#333333` (中灰)
- **边框色**: `#444444` (浅灰)

### 文字色
- **主文字**: `#ffffff` (白色)
- **次要文字**: `#aaaaaa` (浅灰)
- **禁用文字**: `#666666` (深灰)

### 状态色
- **健康**: `#4caf50` (绿色) ✅
- **不健康**: `#f44336` (红色) ❌
- **检查中**: `#2196f3` (蓝色) 🔄
- **未知**: `#9e9e9e` (灰色) ⚫
- **成功**: `#4caf50` (绿色)
- **错误**: `#f44336` (红色)
- **警告**: `#ff9800` (橙色)

### 按钮色
- **主按钮**: `#2196f3` (蓝色)
- **主按钮悬停**: `#1976d2` (深蓝)
- **次按钮**: `#666666` (灰色)
- **危险按钮**: `#f44336` (红色)

---

## 组件层次结构

```
App
├── MainWindow
│   ├── Header (Logo + Title)
│   ├── TabBar
│   │   ├── ProxyListTab (代理管理)
│   │   ├── HealthCheckTab (健康检查)
│   │   ├── MonitorTab (配置监控)
│   │   ├── MergeTab (配置合并)
│   │   └── SettingsTab (设置)
│   ├── TabContent
│   │   └── [Current Tab View]
│   └── StatusBar
└── [Dialogs]
    ├── AddProxyDialog
    ├── EditProxyDialog
    └── ConfirmDialog
```

---

## 交互流程

### 添加代理流程
1. 点击 "添加代理" 按钮
2. 打开添加代理对话框
3. 填写代理信息 (或使用代理字符串)
4. 点击 "保存"
5. 验证输入
6. 添加到列表
7. 保存配置
8. 刷新界面

### 健康检查流程
1. 点击 "检查所有" 按钮
2. 显示进度指示器
3. 逐个检查启用的代理
4. 更新每个代理的状态
5. 显示检查结果
6. 保存健康状态

### 监控流程
1. 选择 Clash 配置文件
2. 点击 "启动监控"
3. 后台监控文件变化
4. 检测到变化后等待防抖
5. 触发合并操作
6. 记录日志
7. 显示结果

### 合并流程
1. 选择 Clash 配置文件
2. 配置本地代理参数
3. 点击 "执行合并"
4. 验证配置文件
5. 创建备份
6. 添加本地代理节点
7. 更新代理组
8. 保存文件
9. 显示结果

---

## 实现优先级

### Phase 3.2: 代理列表界面 (高优先级)
- ProxyListTab 基础组件
- 代理列表显示
- 添加/编辑/删除功能
- 启用/禁用功能

### Phase 3.3: 健康检查面板 (高优先级)
- HealthCheckTab 基础组件
- 健康检查配置
- 手动检查功能
- 结果显示

### Phase 3.4: 监控面板 (中优先级)
- MonitorTab 基础组件
- 文件选择
- 启动/停止监控
- 日志显示

### Phase 3.5: 合并面板 (中优先级)
- MergeTab 基础组件
- 配置表单
- 合并功能
- 结果显示

### Phase 3.6: 设置界面 (低优先级)
- SettingsTab 基础组件
- 通用设置
- 关于信息
- 导入/导出

---

**设计完成**
**下一步**: 开始实现 ProxyListTab
