# 项目路线图

## 版本规划

### v0.1.2 (当前版本) - 2024-12

**状态**: 已发布

**功能**:
- ✅ 静态YAML配置修改
- ✅ 代理链生成
- ✅ 跨平台GUI
- ✅ CI/CD自动发布

**已解决的问题**:
- ✅ Windows标题栏显示问题
- ✅ Windows独立exe资源打包
- ✅ Makepad中文字体资源处理

---

### v0.2.0 - 动态代理核心 + 自动配置管理 (开发中)

**预计时间**: 2-3周

**当前进度**: Task 1.x 已完成 (Core模块), Task 2.x 开发中

**主要功能**:
- ✅ **Task 1.1-1.6**: 本地SOCKS5服务器 (已完成)
  - ✅ 监听本地端口 (127.0.0.1:10808)
  - ✅ 完整SOCKS5协议支持
  - ✅ TCP连接转发
  - ✅ 单上游代理转发
  - ✅ 认证支持
  - ✅ 9/9测试全部通过
- ⏳ **Task 2.1**: 上游代理管理数据结构
  - 定义 `UpstreamProxy` 和 `ProxyHealth` 结构
  - 配置文件序列化/反序列化
  - 增删改查API
- ⏳ **Task 2.2**: 健康检查器
  - SOCKS5连接测试
  - 延迟测量
  - 后台定时检查
- ⏳ **Task 2.3**: Clash配置文件监控
  - 使用 `notify` crate监控文件变化
  - 防抖处理 (2秒延迟)
  - 自动触发合并
- ⏳ **Task 2.4**: 配置自动合并器
  - 复用现有Python脚本或纯Rust实现
  - 自动添加Local-Chain-Proxy节点
  - 自动添加到所有select代理组
  - 自动备份原配置

**技术实现**:
- 引入 `notify` crate用于文件监控
- 使用 `serde_yaml` 解析和修改Clash配置
- 配置持久化到 `~/.config/clash-chain-patcher/config.json`
- 健康检查使用SOCKS5连接测试 + HTTP请求验证

**验收标准**:
- ✅ 本地SOCKS5服务器稳定运行
- ⏳ 能够管理多个上游代理
- ⏳ 健康检查准确识别不可用代理
- ⏳ 订阅更新后自动合并配置
- ⏳ 配置备份和错误恢复正常工作

---

### v0.3.0 - GUI集成和自动化 (规划中)

**预计时间**: v0.2.0后2-3周

**主要功能**:
- [ ] **Task 2.5**: GUI上游代理管理界面
  - 代理列表视图
  - 添加/编辑/删除对话框
  - 启用/禁用切换
- [ ] **Task 2.6**: GUI健康状态显示
  - 实时延迟显示
  - 状态图标 (✅ ⚠️ ❌)
  - 手动测试按钮
- [ ] **Task 2.7**: GUI Clash配置监控界面
  - 配置路径输入/浏览
  - 自动检测常见路径
  - 监控状态指示
  - 手动合并按钮
  - 备份列表查看
- [ ] **Task 2.8**: 主界面整合
  - 统一布局
  - 启动/停止按钮
  - 状态栏
  - 日志面板
- [ ] **Task 2.9** (可选): Clash API集成
  - 实现 `ClashApiClient`
  - 自动重载配置
  - 自动切换节点

**GUI设计**:
```
┌─────────────────────────────────────────────────────┐
│ Clash Chain Patcher                    [_] [□] [×] │
├─────────────────────────────────────────────────────┤
│ [配置修改] [代理服务] [设置]                         │
├─────────────────────────────────────────────────────┤
│ 上游代理列表                                         │
│ ┌─────┬────────────┬──────┬────────┬────────────┐  │
│ │启用 │ 名称       │ 地址  │ 延迟   │ 状态       │  │
│ ├─────┼────────────┼──────┼────────┼────────────┤  │
│ │ ✓   │ 香港代理1  │ 64...│ 120ms  │ ✅ 正常    │  │
│ │ ✓   │ 美国代理2  │ 45...│ 300ms  │ ✅ 正常    │  │
│ └─────┴────────────┴──────┴────────┴────────────┘  │
│ [添加] [编辑] [删除] [测试]                          │
│                                                      │
│ Clash配置监控                                        │
│ 配置路径: /Users/xxx/.config/clash/config.yaml      │
│ □ 启用自动监控  □ 自动合并配置                       │
│ 状态: 🟢 监控中  最后更新: 2026-02-02 18:30:45      │
│                                                      │
│ 本地代理服务器                                       │
│ 监听: 127.0.0.1:10808  状态: 🟢 运行中              │
│ [启动] [停止] [重启]                                 │
│                                                      │
│ 日志面板                                             │
│ [INFO] Proxy server started on 127.0.0.1:10808      │
│ [INFO] Config changed, merging...                   │
│ [INFO] Connected 127.0.0.1:57299 -> 3.223.36.72:80  │
└─────────────────────────────────────────────────────┘
```

**验收标准**:
- GUI所有功能可通过界面操作
- 状态实时更新
- 配置持久化保存
- 日志清晰易读

---

### v0.4.0 - 高级功能和优化 (规划中)

**预计时间**: v0.3.0后2-3周

**主要功能**:
- [ ] 多上游自动选择
  - 最低延迟策略
  - 轮询策略
  - 随机策略
  - 优先级策略
- [ ] 自动故障切换
  - 检测失败自动切换
  - 可配置切换阈值
  - 恢复后自动切回
- [ ] 连接监控和统计
  - 实时连接列表
  - 流量统计图表
  - 连接历史记录
- [ ] 性能优化
  - 连接池复用
  - 内存使用优化
  - 并发连接优化
- [ ] 系统集成
  - 系统托盘图标
  - 开机自启动
  - 后台运行模式
  - 通知中心集成

**性能目标**:
- 单连接延迟: <5ms (p99)
- 并发连接: >1000
- 内存占用: <100MB (空闲时)
- CPU占用: <10% (空闲时)

---

### v1.0.0 - 生产就绪 (目标版本)

**预计时间**: 2025年Q2

**里程碑要求**:
- [ ] 功能完整
  - 所有计划功能实现
  - 充分的配置选项
  - 完善的错误处理
- [ ] 质量保证
  - 单元测试覆盖率>80%
  - 集成测试覆盖主要场景
  - 长时间稳定运行测试(7天+)
  - 压力测试通过
- [ ] 文档完善
  - 完整的用户手册
  - API文档
  - 故障排查指南
  - 视频教程
- [ ] 跨平台验证
  - Windows 10/11测试
  - macOS 10.15+测试
  - Linux(Ubuntu/Debian/Fedora)测试

**可选功能**:
- 自动更新
- 统计数据上报(可选)
- 多语言支持
- WebUI远程管理

---

## 当前任务详情 (v0.2.0)

### Phase 1: Core模块 (已完成 ✅)

| Task | 描述 | 状态 | 完成日期 |
|------|------|------|---------|
| 1.1 | 项目结构调整 | ✅ | 2026-02-02 |
| 1.2 | SOCKS5服务器实现 | ✅ | 2026-02-02 |
| 1.3 | 上游连接管理 | ✅ | 2026-02-02 |
| 1.4 | 流量转发实现 | ✅ | 2026-02-02 |
| 1.5 | 命令行工具 | ✅ | 2026-02-02 |
| 1.6 | 测试和文档 | ✅ | 2026-02-02 |

**测试结果**: 9/9 Core测试全部通过

---

### Phase 2: 配置管理和监控 (开发中 ⏳)

| Task | 描述 | 状态 | 预计时间 |
|------|------|------|---------|
| 2.1 | 上游代理管理数据结构 | ⏳ | 1天 |
| 2.2 | 健康检查器实现 | ⏳ | 2天 |
| 2.3 | Clash配置文件监控 | ⏳ | 2天 |
| 2.4 | 配置自动合并器 | ⏳ | 2天 |

**依赖库**:
- `notify = "7.0"` - 文件监控
- `serde_yaml = "0.9"` - Clash配置解析
- `reqwest = "0.12"` - HTTP健康检查
- `chrono = "0.4"` - 时间戳

---

### Phase 3: GUI集成 (规划中 📋)

| Task | 描述 | 状态 | 预计时间 |
|------|------|------|---------|
| 2.5 | 上游代理管理界面 | 📋 | 3天 |
| 2.6 | 健康状态显示 | 📋 | 2天 |
| 2.7 | Clash配置监控界面 | 📋 | 2天 |
| 2.8 | 主界面整合 | 📋 | 2天 |
| 2.9 | (可选) Clash API集成 | 📋 | 2天 |

---

## 功能对比

| 功能 | v0.1.2 | v0.2.0 | v0.3.0 | v0.4.0 | v1.0.0 |
|------|--------|--------|--------|--------|--------|
| YAML配置修改 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 本地SOCKS5服务 | ❌ | ✅ | ✅ | ✅ | ✅ |
| 单上游转发 | ❌ | ✅ | ✅ | ✅ | ✅ |
| 多上游管理 | ❌ | ✅ | ✅ | ✅ | ✅ |
| 健康检查 | ❌ | ✅ | ✅ | ✅ | ✅ |
| 配置文件监控 | ❌ | ✅ | ✅ | ✅ | ✅ |
| 自动配置合并 | ❌ | ✅ | ✅ | ✅ | ✅ |
| GUI管理界面 | ❌ | ❌ | ✅ | ✅ | ✅ |
| 自动故障切换 | ❌ | ❌ | ❌ | ✅ | ✅ |
| 连接监控 | ❌ | ❌ | ❌ | ✅ | ✅ |
| 性能优化 | ❌ | ❌ | ❌ | ✅ | ✅ |
| 系统托盘 | ❌ | ❌ | ❌ | ✅ | ✅ |
| 自动更新 | ❌ | ❌ | ❌ | ❌ | ✅ |

---

## 设计原则变化

### 原方案 (已废弃 ❌)
使用OS级别拦截方案：
- Linux: iptables + redsocks
- Windows: Proxifier (付费)
- macOS: Proxifier / proxychains-ng

**问题**:
- ❌ 配置复杂
- ❌ 需要系统权限
- ❌ Windows需要付费软件
- ❌ 跨平台兼容性差

### 新方案 (当前采用 ✅)
配置文件监控 + 自动合并：
- 监控Clash配置文件变化
- 自动合并本地代理节点
- GUI管理上游代理
- 健康检查和自动切换

**优势**:
- ✅ 纯配置文件操作
- ✅ 无需系统权限
- ✅ 完全免费
- ✅ 跨平台兼容
- ✅ 用户体验好
- ✅ 符合项目理念

---

## 长期愿景

### 2.0版本可能的方向

1. **规则引擎**
   - 基于域名/IP的路由规则
   - 自定义脚本支持
   - 与GeoIP集成

2. **协议扩展**
   - HTTP代理支持
   - Shadowsocks支持
   - Trojan支持

3. **集群模式**
   - 多实例协同
   - 配置同步
   - 统一管理

4. **WebUI**
   - 浏览器访问管理
   - 远程控制
   - RESTful API

5. **插件系统**
   - 自定义协议处理
   - 流量分析插件
   - 第三方集成

---

## 社区和贡献

### 欢迎贡献的领域

1. **代码贡献**
   - Bug修复
   - 新功能实现
   - 性能优化
   - 测试用例

2. **文档贡献**
   - 用户指南
   - 教程文章
   - 翻译

3. **测试和反馈**
   - Bug报告
   - 功能建议
   - 使用案例分享

---

## 版本命名规则

遵循语义化版本 (Semantic Versioning):

- **主版本号** (Major): 不兼容的API变更
- **次版本号** (Minor): 向后兼容的新功能
- **修订号** (Patch): 向后兼容的问题修复

示例:
- `0.1.2` → `0.2.0`: 添加动态代理核心功能
- `0.2.0` → `0.2.1`: 修复SOCKS5协议bug
- `0.x.y` → `1.0.0`: 正式生产就绪版本

---

## 发布周期

- **Major版本**: 视功能成熟度而定
- **Minor版本**: 每2-4周
- **Patch版本**: 按需发布(重要bug修复)

---

## 反馈渠道

- **GitHub Issues**: Bug报告和功能请求
- **GitHub Discussions**: 技术讨论和使用交流
- **Pull Requests**: 代码贡献

---

最后更新: 2026-02-02
